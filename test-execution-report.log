
> agent-communication-mcp@1.0.0 test
> vitest run


 RUN  v3.2.3 /home/miyagi/dev/personal_pj/agent-communication-mcp

 ❯ tests/integration/scenarios/room-messaging-flow.test.ts (8 tests | 1 failed) 46ms
   ✓ Room-Messaging Flow Integration Tests > Complete workflow scenarios > should handle basic room creation and messaging flow 11ms
   ✓ Room-Messaging Flow Integration Tests > Complete workflow scenarios > should handle multi-room conversation flow 2ms
   ✓ Room-Messaging Flow Integration Tests > Complete workflow scenarios > should handle agent lifecycle in rooms 4ms
   ✓ Room-Messaging Flow Integration Tests > Complete workflow scenarios > should handle mention notifications across conversations 3ms
   ✓ Room-Messaging Flow Integration Tests > Error handling in workflows > should handle errors gracefully without corrupting state 2ms
   ✓ Room-Messaging Flow Integration Tests > Error handling in workflows > should maintain consistency during concurrent operations 3ms
   ✓ Room-Messaging Flow Integration Tests > Management operations in workflows > should provide accurate status during complex operations 3ms
   × Room-Messaging Flow Integration Tests > Management operations in workflows > should handle message pagination in active conversations 16ms
     → expected 'Message 11' to be 'Message 1' // Object.is equality
 ❯ tests/management/unit/DataScanner.test.ts (24 tests | 24 failed) 266ms
   × DataScanner > scanRoomDirectory > should scan room directory and return accurate statistics 53ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > scanRoomDirectory > should handle empty room correctly 39ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > scanRoomDirectory > should handle missing presence file gracefully 23ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > scanRoomDirectory > should handle missing messages file gracefully 3ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > scanRoomDirectory > should handle non-existent room directory gracefully 5ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > getFileStats > should return file size for existing files 4ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > getFileStats > should return zero size for non-existent files 12ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > getFileStats > should return zero size for empty files 6ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countLines > should count lines in message files accurately 6ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countLines > should handle empty files 13ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countLines > should return 0 for non-existent files 33ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countLines > should use streaming for large files 7ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countLines > should handle files with no trailing newline 2ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countOnlineUsers > should count online users correctly 3ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countOnlineUsers > should handle empty presence files 2ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countOnlineUsers > should return 0 for non-existent presence files 3ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countOnlineUsers > should handle corrupted presence files 3ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > countOnlineUsers > should handle presence file with mixed status types 2ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > performance and memory efficiency > should handle very large message files efficiently 6ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > performance and memory efficiency > should process multiple rooms concurrently 2ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > error handling > should handle permission errors gracefully 10ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > error handling > should handle corrupted rooms.json file 5ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > error handling > should handle missing data directory 1ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
   × DataScanner > error handling > should continue scanning other rooms if one fails 2ms
     → Cannot find module '../../../src/features/management/DataScanner'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/DataScanner.test.ts
 ❯ tests/management/unit/ManagementService.test.ts (19 tests | 19 failed) 282ms
   × ManagementService > getStatus > should return system-wide statistics when no roomName provided 66ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > getStatus > should return specific room statistics when roomName provided 9ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > getStatus > should handle empty room correctly 44ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > getStatus > should throw RoomNotFoundError for non-existent room 21ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > getStatus > should calculate storage size correctly 4ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > getStatus > should handle missing presence.json file gracefully 11ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > getStatus > should handle missing messages.jsonl file gracefully 9ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should require confirm=true to clear messages 41ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should clear messages when confirm=true 9ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should throw RoomNotFoundError for non-existent room 20ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should handle empty room clearing 20ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should update rooms.json after clearing messages 2ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should actually remove messages from messages.jsonl file 2ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > clearRoomMessages > should not affect other rooms when clearing one room 2ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > error handling > should throw StorageError when rooms.json is corrupted 5ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > error handling > should throw StorageError when data directory does not exist 3ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > error handling > should handle permission errors gracefully 2ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > performance > should handle large number of rooms efficiently 3ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
   × ManagementService > performance > should handle large message files efficiently 2ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/ManagementService.test.ts
 ❯ tests/management/unit/StatsCollector.test.ts (15 tests | 15 failed) 295ms
   × StatsCollector > collectSystemStats > should collect accurate system-wide statistics 92ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectSystemStats > should calculate storage sizes correctly 34ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectSystemStats > should handle rooms with missing files 33ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectRoomStats > should collect detailed statistics for a specific room 4ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectRoomStats > should handle empty room correctly 5ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectRoomStats > should count messages correctly 16ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectRoomStats > should throw error for non-existent room 17ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectMostActiveRoom > should identify the most active room by message count 11ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectMostActiveRoom > should handle tie-breaking by online users 27ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > collectMostActiveRoom > should return null when no rooms exist 8ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > performance and memory efficiency > should handle large message files without loading everything into memory 19ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > performance and memory efficiency > should use streaming for message counting 2ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > error handling > should handle corrupted JSON files gracefully 2ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > error handling > should handle permission errors 11ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
   × StatsCollector > error handling > should handle malformed message lines 6ms
     → Cannot find module '../../../src/features/management/StatsCollector'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/unit/StatsCollector.test.ts
 ❯ tests/management/integration/stats-accuracy.test.ts (13 tests | 13 failed) 373ms
   × Management Statistics Accuracy Integration Tests > Cross-service Statistics Consistency > should have consistent statistics across all services 122ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Cross-service Statistics Consistency > should have consistent room-level statistics 30ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Message Count Accuracy > should count messages accurately across different room sizes 39ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Message Count Accuracy > should accurately count messages by agent 33ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Online User Count Accuracy > should count online users accurately across all rooms 12ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Online User Count Accuracy > should handle different user status types correctly 22ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Storage Size Accuracy > should calculate storage sizes accurately 10ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Storage Size Accuracy > should handle empty files correctly 26ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Data Integrity After Operations > should maintain accuracy after clearing room messages 14ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Data Integrity After Operations > should maintain consistency across services after data changes 4ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Performance Under Load > should maintain accuracy even with concurrent access 8ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Edge Cases and Error Scenarios > should handle partially corrupted data gracefully while maintaining accuracy for valid data 13ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
   × Management Statistics Accuracy Integration Tests > Edge Cases and Error Scenarios > should maintain accuracy when rooms have malformed message lines 7ms
     → Cannot find module '../../../src/features/management'
Require stack:
- /home/miyagi/dev/personal_pj/agent-communication-mcp/tests/management/integration/stats-accuracy.test.ts
 ❯ tests/validation/schema-validation.test.ts (19 tests | 5 failed) 61ms
   ✓ Schema Validation Tests > Room Schema Validation > should validate create_room input schema 5ms
   ✓ Schema Validation Tests > Room Schema Validation > should reject invalid room names 2ms
   ✓ Schema Validation Tests > Room Schema Validation > should validate create_room output schema 1ms
   ✓ Schema Validation Tests > Room Schema Validation > should validate enter_room input schema 1ms
   ✓ Schema Validation Tests > Room Schema Validation > should validate enter_room input without profile 0ms
   ✓ Schema Validation Tests > Room Schema Validation > should validate list_room_users input schema 0ms
   ✓ Schema Validation Tests > Message Schema Validation > should validate send_message input schema 1ms
   ✓ Schema Validation Tests > Message Schema Validation > should reject invalid message content 1ms
   ✓ Schema Validation Tests > Message Schema Validation > should validate send_message output schema 0ms
   ✓ Schema Validation Tests > Message Schema Validation > should validate get_messages input schema 1ms
   × Schema Validation Tests > Message Schema Validation > should validate get_messages with minimal input 13ms
     → expected undefined to be false // Object.is equality
   × Schema Validation Tests > Message Schema Validation > should reject invalid limit values 9ms
     → expected true to be false // Object.is equality
   × Schema Validation Tests > Message Schema Validation > should validate get_messages output schema 4ms
     → expected false to be true // Object.is equality
   ✓ Schema Validation Tests > Management Schema Validation > should validate get_status input schema 1ms
   × Schema Validation Tests > Management Schema Validation > should validate clear_room_messages input schema 1ms
     → expected false to be true // Object.is equality
   × Schema Validation Tests > Management Schema Validation > should validate clear_room_messages with minimal input 2ms
     → expected false to be true // Object.is equality
   ✓ Schema Validation Tests > Management Schema Validation > should reject invalid timestamp format 5ms
   ✓ Schema Validation Tests > Common Validation Rules > should enforce room name pattern across schemas 2ms
   ✓ Schema Validation Tests > Common Validation Rules > should enforce agent name constraints across schemas 9ms
 ❯ tests/rooms/unit/PresenceStorage.test.ts (24 tests | 2 failed) 308ms
   ✓ PresenceStorage > readPresence > should return empty presence data when file does not exist 17ms
   ✓ PresenceStorage > readPresence > should read existing presence data 2ms
   ✓ PresenceStorage > readPresence > should create room directory if it does not exist 14ms
   ✓ PresenceStorage > writePresence > should write presence data to file 2ms
   ✓ PresenceStorage > addUser > should add user to room 18ms
   × PresenceStorage > addUser > should add user without profile 81ms
     → expected { status: 'online', …(2) } to match object { status: 'online', …(2) }
(1 matching property omitted from actual)
   ✓ PresenceStorage > removeUser > should remove user from room 5ms
   ✓ PresenceStorage > removeUser > should throw error when user does not exist 2ms
   ✓ PresenceStorage > updateUserStatus > should update user status 2ms
   ✓ PresenceStorage > updateUserStatus > should throw error when user does not exist 10ms
   ✓ PresenceStorage > getUsersInRoom > should return all users in room 8ms
   ✓ PresenceStorage > getUsersInRoom > should return empty array for room with no users 16ms
   ✓ PresenceStorage > isUserInRoom > should return true for user in room 15ms
   ✓ PresenceStorage > isUserInRoom > should return false for user not in room 2ms
   ✓ PresenceStorage > utility methods > getUserStatus > should return user status 14ms
   ✓ PresenceStorage > utility methods > getUserStatus > should return null for non-existing user 4ms
   ✓ PresenceStorage > utility methods > getOnlineUsersCount > should return correct online user count 19ms
   ✓ PresenceStorage > utility methods > getOnlineUsersCount > should return 0 for room with no online users 8ms
   ✓ PresenceStorage > utility methods > incrementUserMessageCount > should increment user message count 12ms
   ✓ PresenceStorage > utility methods > incrementUserMessageCount > should throw error for non-existing user 2ms
   ✓ PresenceStorage > utility methods > clearRoomPresence > should clear all users from room 4ms
   ✓ PresenceStorage > utility methods > getAllUsersInRoom > should return all users with their data 2ms
   × PresenceStorage > error handling > should handle file system errors gracefully 28ms
     → promise resolved "{ roomName: 'error-room', users: {} }" instead of rejecting
   ✓ PresenceStorage > error handling > should handle JSON parse errors 1ms
 ❯ tests/integration/concurrent-access.test.ts (4 tests | 4 failed) 1026ms
   × Integration: Concurrent Access Test > Concurrent Message Sending > should handle concurrent messages from multiple agents 842ms
     → MessagingAPI is not a constructor
   × Integration: Concurrent Access Test > Concurrent Room Operations > should handle concurrent room creation attempts 72ms
     → MessagingAPI is not a constructor
   × Integration: Concurrent Access Test > Concurrent Room Operations > should handle concurrent join/leave operations 19ms
     → MessagingAPI is not a constructor
   × Integration: Concurrent Access Test > File Lock Contention > should serialize access when multiple operations target same file 79ms
     → MessagingAPI is not a constructor
 ❯ tests/integration/full-flow.test.ts (5 tests | 5 failed) 1154ms
   × Integration: Full Flow Test > Complete Room Lifecycle > should create room, join, send message, and get status 869ms
     → MessagingAPI is not a constructor
   × Integration: Full Flow Test > Multi-Agent Interaction > should handle multiple agents with mentions 95ms
     → MessagingAPI is not a constructor
   × Integration: Full Flow Test > Error Handling > should handle room not found errors 101ms
     → MessagingAPI is not a constructor
   × Integration: Full Flow Test > Error Handling > should handle agent not in room errors 19ms
     → MessagingAPI is not a constructor
   × Integration: Full Flow Test > Error Handling > should handle duplicate room creation 4ms
     → MessagingAPI is not a constructor
stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle creation of 100 rooms
Creating 100 rooms...

 ❯ tests/rooms/unit/RoomStorage.test.ts (17 tests | 2 failed) 166ms
   ✓ RoomStorage > readRooms > should return empty rooms data when file does not exist 11ms
   ✓ RoomStorage > readRooms > should read existing rooms data 2ms
   ✓ RoomStorage > readRooms > should handle JSON parse errors 8ms
   ✓ RoomStorage > writeRooms > should write rooms data to file 1ms
   ✓ RoomStorage > writeRooms > should create directory if it does not exist 1ms
   ✓ RoomStorage > createRoom > should create a new room 30ms
   × RoomStorage > createRoom > should create room without description 41ms
     → expected { …(3) } to match object { description: undefined, …(2) }
(1 matching property omitted from actual)
   ✓ RoomStorage > roomExists > should return true for existing room 11ms
   ✓ RoomStorage > roomExists > should return false for non-existing room 9ms
   ✓ RoomStorage > getRoomData > should return room data for existing room 2ms
   ✓ RoomStorage > getRoomData > should return null for non-existing room 1ms
   ✓ RoomStorage > updateRoomUserCount > should update user count for existing room 12ms
   ✓ RoomStorage > updateRoomUserCount > should throw error for non-existing room 5ms
   ✓ RoomStorage > utility methods > getAllRoomNames > should return all room names 3ms
   ✓ RoomStorage > utility methods > getAllRoomNames > should return empty array when no rooms exist 2ms
   ✓ RoomStorage > utility methods > clearAllRooms > should clear all rooms 2ms
   × RoomStorage > error handling > should handle file system errors gracefully 23ms
     → promise resolved "{ rooms: {} }" instead of rejecting
 ❯ tests/integration/adapters/RealAdapters.test.ts (13 tests | 13 failed) 1307ms
   × Real Adapters Integration Tests > Rooms Adapter with Real Implementation > should create and list rooms 956ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Rooms Adapter with Real Implementation > should handle agent room membership 45ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Rooms Adapter with Real Implementation > should enforce room existence for operations 10ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Messaging Adapter with Real Implementation > should send and retrieve messages 29ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Messaging Adapter with Real Implementation > should extract mentions correctly 11ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Messaging Adapter with Real Implementation > should enforce room membership for messaging 25ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Messaging Adapter with Real Implementation > should support message pagination 8ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Management Adapter with Real Implementation > should provide accurate system status 54ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Management Adapter with Real Implementation > should clear room messages 34ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Management Adapter with Real Implementation > should enforce room existence for management operations 15ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Cross-Adapter Integration > should maintain consistency across all adapters 43ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Cross-Adapter Integration > should handle complex workflow scenarios 27ms
     → MessagingAPI is not a constructor
   × Real Adapters Integration Tests > Error Handling in Real Implementation > should maintain data consistency on errors 47ms
     → MessagingAPI is not a constructor
stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle creation of 100 rooms
Room creation completed in 131ms
Average time per room: 1.31ms

stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle 50 agents entering each room
Setting up rooms for agent entry test...

 ❯ tests/rooms/integration/room-lifecycle.test.ts (7 tests | 2 failed) 265ms
   ✓ Room Lifecycle Integration Tests > Complete room lifecycle > should handle create → enter → leave → cleanup flow 123ms
   ✓ Room Lifecycle Integration Tests > Complete room lifecycle > should handle multiple rooms with overlapping users 31ms
   ✓ Room Lifecycle Integration Tests > Complete room lifecycle > should handle error scenarios gracefully 19ms
   ✓ Room Lifecycle Integration Tests > Complete room lifecycle > should maintain data consistency across operations 32ms
   ✓ Room Lifecycle Integration Tests > Complete room lifecycle > should handle offline user cleanup 6ms
   × Room Lifecycle Integration Tests > Complex scenarios > should handle rapid enter/leave operations 46ms
     → expected 1 to be 10 // Object.is equality
   × Room Lifecycle Integration Tests > Complex scenarios > should handle agent re-entering same room 6ms
     → expected 'initial' to be 'updated' // Object.is equality
stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle 50 agents entering each room
Testing 50 agents entering 10 rooms...

 ❯ tests/messaging/unit/MessageService.test.ts (14 tests | 5 failed) 620ms
   ✓ MessageService > sendMessage > should send a message successfully 82ms
   ✓ MessageService > sendMessage > should extract mentions from message 1ms
   ✓ MessageService > sendMessage > should include metadata in message 5ms
   ✓ MessageService > sendMessage > should throw RoomNotFoundError for non-existent room 1ms
   ✓ MessageService > sendMessage > should throw ValidationError for invalid parameters 1ms
   × MessageService > getMessages > should get messages from room 121ms
     → Storage operation 'createDirectory' failed: Failed to create directory: test-data/rooms/general
   × MessageService > getMessages > should apply limit to messages 84ms
     → Storage operation 'saveMessage' failed: Failed to save message: ENOENT: no such file or directory, open 'test-data/rooms/general/messages.jsonl'
   ✓ MessageService > getMessages > should apply offset to messages 217ms
   × MessageService > getMessages > should filter messages by mentions 66ms
     → expected [ { …(6) }, { …(6) } ] to have a length of 1 but got 2
   ✓ MessageService > getMessages > should return empty result for room with no messages 8ms
   ✓ MessageService > getMessages > should throw RoomNotFoundError for non-existent room 14ms
   × MessageService > getMessageCount > should return 0 for room with no messages 8ms
     → expected 12 to be +0 // Object.is equality
   × MessageService > getMessageCount > should return correct count after sending messages 9ms
     → expected 14 to be 2 // Object.is equality
   ✓ MessageService > getMessageCount > should throw RoomNotFoundError for non-existent room 1ms
 ❯ tests/e2e/mcp-server.test.ts (4 tests | 4 skipped) 66ms
   ↓ E2E: MCP Server > Tool Discovery > should list all available tools
   ↓ E2E: MCP Server > Room Management Flow > should complete full room lifecycle
   ↓ E2E: MCP Server > Error Handling > should handle invalid tool calls
   ↓ E2E: MCP Server > Error Handling > should handle validation errors
 ❯ tests/management/integration/stats-accuracy-verification.test.ts (7 tests | 2 failed) 143ms
   × Management Statistics Accuracy Verification > Directory Scanning Accuracy > should accurately count messages and online users across multiple rooms 71ms
     → expected +0 to be 3 // Object.is equality
   ✓ Management Statistics Accuracy Verification > Directory Scanning Accuracy > should handle rooms.json structure correctly 18ms
   ✓ Management Statistics Accuracy Verification > Message Clearing Verification > should require confirm=true and accurately count cleared messages 17ms
   ✓ Management Statistics Accuracy Verification > Storage Size Calculation > should calculate storage sizes accurately 3ms
   ✓ Management Statistics Accuracy Verification > Error Handling Verification > should handle non-existent rooms correctly 11ms
   ✓ Management Statistics Accuracy Verification > Error Handling Verification > should handle missing files gracefully 1ms
   × Management Statistics Accuracy Verification > Performance Verification > should handle large datasets efficiently 14ms
     → expected +0 to be 5 // Object.is equality
stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle 50 agents entering each room
Agent entry completed in 784ms
Average time per operation: 1.57ms
Total operations: 500

stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle concurrent room operations
Testing concurrent room operations...

stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle concurrent room operations
Concurrent operations completed in 9ms

stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should maintain data consistency under load
Testing data consistency under load...

stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle memory efficiently with large datasets
Testing memory efficiency...

 ❯ tests/e2e/mcp-tools.test.ts (30 tests | 30 skipped) 271ms
   ↓ MCP Tools E2E Tests > Tool Discovery > should list all 9 MCP tools correctly
   ↓ MCP Tools E2E Tests > Tool Discovery > should have correct tool schemas for each tool
   ↓ MCP Tools E2E Tests > Room Management Tools > list_rooms > should return empty list when no rooms exist
   ↓ MCP Tools E2E Tests > Room Management Tools > list_rooms > should return all rooms with metadata
   ↓ MCP Tools E2E Tests > Room Management Tools > create_room > should create room with required parameters
   ↓ MCP Tools E2E Tests > Room Management Tools > create_room > should create room with optional description
   ↓ MCP Tools E2E Tests > Room Management Tools > create_room > should reject duplicate room names
   ↓ MCP Tools E2E Tests > Room Management Tools > enter_room > should allow agent to enter existing room
   ↓ MCP Tools E2E Tests > Room Management Tools > enter_room > should reject entering non-existent room
   ↓ MCP Tools E2E Tests > Room Management Tools > leave_room > should allow agent to leave room they are in
   ↓ MCP Tools E2E Tests > Room Management Tools > leave_room > should reject leaving room agent is not in
   ↓ MCP Tools E2E Tests > Room Management Tools > list_room_users > should return empty list for room with no users
   ↓ MCP Tools E2E Tests > Room Management Tools > list_room_users > should return all users in room
   ↓ MCP Tools E2E Tests > Room Management Tools > list_room_users > should reject listing users for non-existent room
   ↓ MCP Tools E2E Tests > Messaging Tools > send_message > should send message successfully
   ↓ MCP Tools E2E Tests > Messaging Tools > send_message > should extract mentions correctly
   ↓ MCP Tools E2E Tests > Messaging Tools > send_message > should reject message from agent not in room
   ↓ MCP Tools E2E Tests > Messaging Tools > send_message > should reject message to non-existent room
   ↓ MCP Tools E2E Tests > Messaging Tools > get_messages > should retrieve all messages
   ↓ MCP Tools E2E Tests > Messaging Tools > get_messages > should respect limit parameter
   ↓ MCP Tools E2E Tests > Messaging Tools > get_messages > should support pagination with before parameter
   ↓ MCP Tools E2E Tests > Messaging Tools > get_messages > should reject access from agent not in room
   ↓ MCP Tools E2E Tests > Management Tools > get_status > should return initial server status
   ↓ MCP Tools E2E Tests > Management Tools > get_status > should return accurate status with activity
   ↓ MCP Tools E2E Tests > Management Tools > clear_room_messages > should clear all messages in room
   ↓ MCP Tools E2E Tests > Management Tools > clear_room_messages > should return 0 for room with no messages
   ↓ MCP Tools E2E Tests > Management Tools > clear_room_messages > should reject clearing non-existent room
   ↓ MCP Tools E2E Tests > Tool Error Handling > should return proper error for unknown tool
   ↓ MCP Tools E2E Tests > Tool Error Handling > should handle malformed tool arguments gracefully
   ↓ MCP Tools E2E Tests > Tool Integration > should maintain consistency across all tools
 ❯ tests/e2e/full-flow.test.ts (8 tests | 8 skipped) 268ms
   ↓ Agent Communication MCP Server E2E Tests > Complete workflow scenarios > should complete room creation → agent join → message flow
   ↓ Agent Communication MCP Server E2E Tests > Complete workflow scenarios > should handle multi-room conversation scenario
   ↓ Agent Communication MCP Server E2E Tests > Complete workflow scenarios > should handle agent lifecycle and permissions
   ↓ Agent Communication MCP Server E2E Tests > Complete workflow scenarios > should handle message management operations
   ↓ Agent Communication MCP Server E2E Tests > Error scenarios and edge cases > should handle non-existent room operations
   ↓ Agent Communication MCP Server E2E Tests > Error scenarios and edge cases > should handle duplicate room creation
   ↓ Agent Communication MCP Server E2E Tests > Error scenarios and edge cases > should handle message pagination correctly
   ↓ Agent Communication MCP Server E2E Tests > Performance and concurrency > should handle multiple concurrent requests
 ❯ tests/integration/tools/MCPToolEdgeCases.test.ts (29 tests | 29 failed) 289ms
   × MCP Tools Edge Cases and Validation Tests > list_rooms Edge Cases > should handle empty room list consistently 219ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > list_rooms Edge Cases > should handle rooms with special characters 2ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > list_rooms Edge Cases > should handle large number of rooms 10ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > create_room Edge Cases > should reject invalid room names 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > create_room Edge Cases > should handle extremely long room names 2ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > create_room Edge Cases > should handle extremely long descriptions 3ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > create_room Edge Cases > should handle concurrent room creation with same name 2ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > enter_room Edge Cases > should handle invalid agent names 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > enter_room Edge Cases > should handle agent entering same room multiple times 3ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > enter_room Edge Cases > should handle very long agent names 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > send_message Edge Cases > should handle empty messages 23ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > send_message Edge Cases > should handle extremely long messages 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > send_message Edge Cases > should handle malformed mention patterns 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > send_message Edge Cases > should handle messages with special characters and unicode 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > get_messages Edge Cases > should handle invalid limit values 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > get_messages Edge Cases > should handle invalid before parameter 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > get_messages Edge Cases > should handle edge case pagination scenarios 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > get_status Edge Cases > should handle status request with no data 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > get_status Edge Cases > should handle status with malformed extra arguments 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > get_status Edge Cases > should handle status request with extreme data volumes 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > clear_room_messages Edge Cases > should handle clearing non-existent room 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > clear_room_messages Edge Cases > should handle clearing empty room 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > clear_room_messages Edge Cases > should handle clearing room with many messages 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > clear_room_messages Edge Cases > should handle concurrent clear operations 3ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > Tool Parameter Validation > should handle missing required parameters 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > Tool Parameter Validation > should handle extra/unexpected parameters 1ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > Tool Parameter Validation > should handle parameter type mismatches 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > System Stress Tests > should handle rapid successive operations 0ms
     → Cannot read properties of undefined (reading 'method')
   × MCP Tools Edge Cases and Validation Tests > System Stress Tests > should maintain consistency under high load 0ms
     → Cannot read properties of undefined (reading 'method')
stdout | tests/rooms/load/multi-room.test.ts > Multi-Room Load Tests - 100 rooms × 50 users > should handle memory efficiently with large datasets
Query operations on large dataset completed in 24ms
Memory efficiency test completed successfully

 ❯ tests/rooms/load/multi-room.test.ts (5 tests | 4 failed) 2585ms
   × Multi-Room Load Tests - 100 rooms × 50 users > should handle creation of 100 rooms 180ms
     → expected 1 to be 100 // Object.is equality
   × Multi-Room Load Tests - 100 rooms × 50 users > should handle 50 agents entering each room 833ms
     → expected 1 to be 50 // Object.is equality
   × Multi-Room Load Tests - 100 rooms × 50 users > should handle concurrent room operations 14ms
     → expected 1 to be 20 // Object.is equality
   × Multi-Room Load Tests - 100 rooms × 50 users > should maintain data consistency under load 78ms
     → Agent 'consistency-agent-1-1' is not in room 'consistency-room-1'
   ✓ Multi-Room Load Tests - 100 rooms × 50 users > should handle memory efficiently with large datasets  1474ms
 ✓ tests/rooms/unit/RoomService.test.ts (17 tests) 181ms
 ✓ tests/rooms/unit/PresenceService.test.ts (20 tests) 223ms
 ✓ tests/messaging/unit/MessageStorage.test.ts (11 tests) 516ms
 ✓ tests/integration/adapters/ManagementAdapter.test.ts (17 tests) 46ms
 ✓ tests/integration/adapters/RoomsAdapter.test.ts (24 tests) 74ms
stdout | tests/messaging/performance/throughput.test.ts > MessageService Performance Tests > Throughput Requirements > should handle 1000 messages per second
Performance: 1402.52 messages/second
Total time: 713ms for 1000 messages

 ✓ tests/integration/adapters/MessagingAdapter.test.ts (15 tests) 64ms
 ✓ tests/messaging/unit/MessageValidator.test.ts (17 tests) 72ms
 ❯ tests/integration/adapters/AdapterImport.test.ts (14 tests | 1 failed) 5225ms
   ✓ Adapter Import and Integration Tests > Dynamic Adapter Imports > should dynamically import MessagingAdapter 7ms
   ✓ Adapter Import and Integration Tests > Dynamic Adapter Imports > should dynamically import RoomsAdapter 10ms
   ✓ Adapter Import and Integration Tests > Dynamic Adapter Imports > should dynamically import ManagementAdapter 1ms
   ✓ Adapter Import and Integration Tests > Adapter Pattern Compliance > should have consistent initialization pattern across adapters 29ms
   ✓ Adapter Import and Integration Tests > Adapter Pattern Compliance > should handle adapter initialization failures gracefully 8ms
   ✓ Adapter Import and Integration Tests > Adapter Integration with Services > should integrate with LockService for concurrency control 15ms
   × Adapter Import and Integration Tests > Adapter Integration with Services > should handle lock timeout scenarios 5029ms
     → Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   ✓ Adapter Import and Integration Tests > Error Handling Integration > should propagate errors correctly through adapter layers 1ms
   ✓ Adapter Import and Integration Tests > Error Handling Integration > should handle missing dependency imports 85ms
   ✓ Adapter Import and Integration Tests > Adapter Configuration and Environment > should respect environment configuration 1ms
   ✓ Adapter Import and Integration Tests > Adapter Configuration and Environment > should use default configuration when environment variables are missing 0ms
   ✓ Adapter Import and Integration Tests > Adapter Factory Pattern > should create adapters through factory pattern 1ms
   ✓ Adapter Import and Integration Tests > Adapter Factory Pattern > should handle adapter creation errors in factory 1ms
   ✓ Adapter Import and Integration Tests > Adapter Lifecycle Management > should manage adapter lifecycle properly 1ms
 ✓ tests/validation/type-validation.test.ts (14 tests) 67ms
 ✓ tests/setup.test.ts (3 tests) 14ms
 ✓ tests/messaging/unit/MessageCache.test.ts (16 tests) 99ms
 ❯ tests/integration/concurrency/FileLock.test.ts (16 tests | 1 failed) 6459ms
   ✓ File Lock Concurrency Tests > Basic Lock Operations > should acquire and release locks successfully 2ms
   ✓ File Lock Concurrency Tests > Basic Lock Operations > should handle concurrent lock requests 165ms
   ✓ File Lock Concurrency Tests > Basic Lock Operations > should timeout on lock acquisition 106ms
   ✓ File Lock Concurrency Tests > File Operations with Locking > should perform safe file writes 1ms
   ✓ File Lock Concurrency Tests > File Operations with Locking > should handle concurrent writes safely 27ms
   ✓ File Lock Concurrency Tests > File Operations with Locking > should handle concurrent appends safely 39ms
   ✓ File Lock Concurrency Tests > Message File Operations > should handle concurrent message writes to same room 25ms
   ✓ File Lock Concurrency Tests > Message File Operations > should handle presence file updates safely 31ms
   ✓ File Lock Concurrency Tests > Lock Timeout Scenarios > should handle lock timeout during message operations 201ms
   ✓ File Lock Concurrency Tests > Lock Timeout Scenarios > should recover from timeout errors 151ms
   ✓ File Lock Concurrency Tests > Multi-File Lock Scenarios > should handle locks on different files independently 103ms
   × File Lock Concurrency Tests > Multi-File Lock Scenarios > should prevent deadlocks in nested operations 5012ms
     → Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   ✓ File Lock Concurrency Tests > Error Handling in Locked Operations > should release lock when operation throws error 1ms
   ✓ File Lock Concurrency Tests > Error Handling in Locked Operations > should handle filesystem errors gracefully 6ms
   ✓ File Lock Concurrency Tests > Performance and Scalability > should handle high concurrency scenarios  566ms
   ✓ File Lock Concurrency Tests > Performance and Scalability > should manage memory usage with many concurrent locks 7ms
stdout | tests/messaging/performance/throughput.test.ts > MessageService Performance Tests > Throughput Requirements > should efficiently retrieve large message sets
Retrieval time: 131ms for 1000 messages from 5000 total

stdout | tests/messaging/performance/throughput.test.ts > MessageService Performance Tests > Throughput Requirements > should handle mention filtering efficiently
Mention filtering time: 13ms for 200 mentions from 1000 messages

 ✓ tests/messaging/performance/throughput.test.ts (3 tests) 2849ms
   ✓ MessageService Performance Tests > Throughput Requirements > should handle 1000 messages per second  810ms
   ✓ MessageService Performance Tests > Throughput Requirements > should efficiently retrieve large message sets  1682ms
   ✓ MessageService Performance Tests > Throughput Requirements > should handle mention filtering efficiently  354ms
 ✓ tests/integration/file-locking/ConcurrencyTests.test.ts (11 tests) 3583ms
   ✓ File Locking Concurrency Tests > Basic File Locking > should handle multiple concurrent lock requests  535ms
   ✓ File Locking Concurrency Tests > Basic File Locking > should handle lock timeout  556ms
   ✓ File Locking Concurrency Tests > File Operations with Locking > should safely handle concurrent file writes  455ms
   ✓ File Locking Concurrency Tests > File Operations with Locking > should handle concurrent file appends  985ms
   ✓ File Locking Concurrency Tests > Performance under Concurrency > should handle high concurrency without deadlocks  387ms

 Test Files  24 failed | 12 passed (36)
      Tests  147 failed | 274 passed | 42 skipped (463)
     Errors  1 error
   Start at  09:18:52
   Duration  10.73s (transform 12.56s, setup 0ms, collect 39.44s, tests 29.26s, environment 24ms, prepare 21.79s)

